## 太空人入侵游戏（Gesture-Controlled Space Invaders+）

一个基于 **OpenCV 手势识别** 与 **PyGame** 的经典《太空入侵者》风格射击游戏。玩家无需键盘或鼠标，仅通过摄像头捕捉的手势即可控制角色的 **移动、开火与模式翻转**，同时具备计分、生命值、关卡刷新等完整游戏机制。

---

### 功能简介

- **手势控制**：通过摄像头识别玩家手部动作，实现：
  - **左右移动**：跟随手在画面中的水平位置移动飞船
  - **发射激光**：特定手势触发射击（例如手指伸展/合并等，具体取决于你的手势逻辑实现）
  - **模式翻转（FLIP）**：用来开始游戏、重新开始游戏或翻转外星人阵型的攻防方向
- **双排外星人阵列**：
  - 屏幕上、下各有一排外星人阵列，颜色代表不同得分：
    - 红色外星人：高生命或高分值
    - 绿色外星人：中等难度
    - 黄色外星人：基础单位
- **掩体（障碍物）系统**：
  - 玩家与外星人之间存在可被击毁的方块障碍
  - 玩家及外星人的激光均可打碎掩体
- **额外飞船（Extra）**：
  - 随机从 **左/右** 刷新带有高分奖励的特殊飞船
  - 击中后可一次性获得 **额外 500 分**
- **生命与得分显示**：
  - 左上角实时显示：
    - 当前生命值（`Lives`）
    - 当前得分（`Score`）
- **状态提示**：
  - 当手超出摄像头识别范围时，会在左侧显示红色提示：`Hands out of camera scope!`
  - 游戏未开始、死亡时会有对应文字提示，并通过 **FLIP 手势** 进行开始/重开
- **音效与画面**：
  - 激光发射音效、爆炸音效
  - 复古像素字体、太空主题 UI
  - 左侧为摄像头实时画面，右侧为游戏主战场

---

### 环境与依赖

本项目推荐在 **Python 3.10+** 环境下运行，依赖主要包括：

- **opencv-python**：摄像头读取与图像处理
- **mediapipe**：手势 / 手部关键点识别（通过 `cvzone` 封装调用）
- **cvzone**：简化 MediaPipe 手势识别与 OpenCV 集成
- **pygame**：2D 游戏画面、精灵系统与音效
- **numpy**：常规数值运算

依赖清单已写在 `Code/requirements.txt` 中：

```txt
cvzone==1.5.6
numpy==1.24.2
opencv_python==4.7.0.72
pygame==2.5.0
mediapipe==0.10.5
```

如需更新版本，可自行在虚拟环境中调整。

---

### 安装与运行步骤

以下说明假设你使用的是 **类 Unix 系统**（macOS / Linux），并已安装 **Python 3**。

#### 1. 安装 Python3 与 pip（如尚未安装）

- 前往 Python 官网下载安装包：
  - `https://www.python.org/downloads/`
- 安装完成后，确保已安装最新版本的 `pip`：
  - 参考：`https://pip.pypa.io/en/latest/installation/#ensurepip`

#### 2. 进入项目目录

```bash
cd /path/to/太空人入侵游戏
cd Code
```

> 将 `/path/to/太空人入侵游戏` 替换为你本机上的实际路径。

#### 3. （推荐）创建虚拟环境

可以使用你喜欢的方式创建虚拟环境，例如：

```bash
python3 -m venv venv
source venv/bin/activate  # macOS / Linux
```

> 你也可以直接使用项目中已有的虚拟环境 `cvgame`，或根据自己需求新建环境。

#### 4. 安装依赖

在 `Code` 目录下运行：

```bash
pip install -r requirements.txt
```

#### 5. 运行游戏

```bash
python3 main.py
```

首次运行时，**系统可能会弹出摄像头权限提示**，请在弹窗中点击允许，以便游戏能够使用你的摄像头。

---

### 摄像头与手势识别说明

- 游戏通过 `cv2.VideoCapture` 打开摄像头：
  - 代码中默认使用索引 `2`：
    - `video_capture = cv2.VideoCapture(2)`
  - 如果你只有一个摄像头或默认摄像头编号为 0，可修改为：
    - `cv2.VideoCapture(0)`
- 摄像头画面经过：
  - 翻转（镜像效果）
  - 颜色空间转换（BGR → RGB）
  - 旋转后显示在 PyGame 窗口左侧
- 手势识别（在 `player.py` 中实现）通常包括：
  - 检测手掌位置，用于控制飞船在 X 轴的移动
  - 识别某种“开火”手势以发射激光
  - 识别“翻转 / 切换模式”手势，用于：
    - 从开始界面进入游戏
    - 角色死亡后重新开始游戏
    - 在胜利界面重新开局

如果你发现摄像头没有画面或识别不到手势，可以从以下几方面排查：

- **摄像头索引是否正确**（`0 / 1 / 2 ...` 逐个尝试）
- **系统是否授权终端/IDE 使用摄像头**
- **光线是否充足**（手势识别在暗光下不稳定）

---

### 游戏玩法

#### 基础目标

- 控制你的飞船消灭所有外星人
- 通过击毁不同颜色的外星人和额外飞船来获取更高分数
- 避免被外星人激光击中，生命值耗尽后游戏结束

#### 界面布局

- **左侧**：摄像头画面（用于手势识别）
- **右侧**：游戏主战场
  - 外星人阵列（上下两排）
  - 玩家飞船
  - 障碍物 / 掩体
  - 外星人子弹、玩家激光等

#### 游戏状态

- **0：等待开始**
  - 画面显示：`FLIP to start the game`
  - 通过“FLIP 手势”开始游戏
- **1：正常游戏中**
  - 可以移动、射击，外星人也在发射激光
- **2：玩家死亡**
  - 显示：`You died!` 与 `FLIP to restart`
  - 再次做 FLIP 手势即可重新开始
- **4：胜利**
  - 当所有外星人被消灭时显示：`You won` 与 `FLIP to restart`

> 游戏中还会不定时生成 `Extra` 飞船，被击中可获得额外高分奖励。

---

### 项目结构简要说明

- **`Code/main.py`**：
  - 游戏入口文件，窗口初始化、主循环、摄像头读取与画面合成
  - 定义 `Game` 类，负责外星人、障碍物、计分、生命值、游戏状态切换等核心逻辑
- **`Code/player.py`**：
  - 玩家角色与手势识别逻辑（调用 OpenCV / cvzone / MediaPipe）
  - 生成玩家激光、管理游戏状态（开始、死亡、重启等）
- **`Code/alien.py`**：
  - 普通外星人与 `Extra` 飞船精灵类
- **`Code/laser.py`**：
  - 玩家与外星人激光精灵类
- **`Code/obstacle.py`**：
  - 障碍物（掩体）方块与形状定义
- **`Resources/`**：
  - 图片资源：玩家、外星人、操作提示图 (`move0.png`, `shoot0.png`, `flip0.png` 等)
  - 音效资源：`laser.wav`, `explosion.wav`
  - 字体资源：`Pixeled.ttf`

---

### 常见问题（FAQ）

- **Q：运行时黑屏或没有摄像头画面？**  
  **A**：检查摄像头索引（0/1/2 等），确认系统隐私设置中已允许终端/IDE 使用摄像头。

- **Q：提示找不到某些依赖库？**  
  **A**：确认已在当前虚拟环境中执行 `pip install -r requirements.txt`，并且终端中 `python3` 指向的解释器与安装依赖的环境一致。

- **Q：游戏很卡或 CPU 占用高？**  
  **A**：尝试关闭其他占用摄像头和 GPU 的程序，或者降低摄像头分辨率、减少后台应用。

---

### 许可证

本项目采用 **MIT License** 授权，详情参见仓库中的 `LICENSE` 文件。你可以自由地复制、修改和分发本项目，但请在再发布时保留原作者版权声明。
